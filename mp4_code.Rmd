---
title: "Take Me Out to Which Ballgame?"
author: "Jay-Ho Chung, Brigitte Goeler-Slough, Nathan Ives"
date: "4/23/2018"
output: 
  html_document:
    code_folding: hide
    df_print: paged
    theme: spacelab
---

```{r (Packages), warning = FALSE, message = FALSE}
library(mdsr)
library(RMySQL)
library(tidyverse)
```

```{r (Connecting to the Database)}
db <- dbConnect_scidb(dbname = "lahman")
```

```{r (Pitchers), warning = FALSE}
pitchers <- db %>% 
  dbGetQuery(
    "SELECT hof.playerID, hof.yearID, nameFirst, nameLast, 
    sum(G) as G, sum(pi.GS) as GS, sum(IPouts/3) as IP, 
    sum(CG) as CG, sum(SHO) as SHO, sum(SV) as SV, sum(W) as W,
    sum(L) as L, sum(H) as H, sum(BB) as BB, sum(ER) as ER,
    sum(SO) as SO, ((sum(ER) / (sum(IPouts)/3)) * 9) as ERA, 
    ((sum(H) + sum(BB)) / (sum(IPouts) / 3)) as WHIP
    FROM HallOfFame hof
    JOIN Master ma ON ma.playerID = hof.playerID
    JOIN Pitching pi ON pi.playerID = hof.playerID
    WHERE hof.inducted = 'Y'
    GROUP BY hof.playerID
HAVING G > 100;"
  )
pitchers
```

```{r (Hitters), warning = FALSE}
hitters <- db %>% 
  dbGetQuery("SELECT hof.playerID, hof.yearID, nameFirst,
              nameLast, sum(AB) as AB, sum(R) as R, sum(H) as H,
              sum(2B) as 2B, sum(3B) as 3B, sum(HR) as HR,
              sum(RBI) as RBI, sum(SB) as SB, 
              (sum(H) / sum(AB)) as AVG
              FROM HallOfFame hof
              JOIN Master ma ON ma.playerID = hof.playerID
              JOIN Batting ba ON ba.playerID = hof.playerID
              WHERE hof.inducted = 'Y'
              GROUP BY hof.playerID
              HAVING AB > 2000;")
hitters
```

```{r (not inducted), warning = FALSE}
not_inducted <- db %>%
  dbGetQuery("SELECT playerID, yearid, ballots, needed, votes, inducted, 
sum(inducted = 'Y') as indct
FROM HallOfFame
GROUP BY playerID
HAVING indct = 0")
not_inducted
```

```{r (batteres not inducted), warning = FALSE}
batters_not_inducted <- db %>% 
  dbGetQuery("SELECT hof.playerID, nameLast, nameFirst, 
              min(hof.yearid) AS first_year, ballots, needed,
              votes, inducted, max(votes / ballots) as PCT,
             sum(AB) as AB, sum(R) as R, sum(H) as H,
             sum(2B) as 2B, sum(3B) as 3B, sum(HR) as HR,
             sum(RBI) as RBI, sum(SB) as SB, 
             (sum(H) / sum(AB)) as AVG
             sum(inducted = 'Y') as indct
FROM HallOfFame as hof
JOIN Batting ba ON ba.playerID = hof.playerID
JOIN Master ma ON ma.playerID = hof.playerID
WHERE hof.yearid > 1979
GROUP BY hof.playerID
HAVING indct = 0
  AND AB > 4000
  AND PCT > 0.2
ORDER BY PCT desc;")

batters_not_inducted
```

```{r}
pitchers_not_inducted <- db %>%
  dbGetQuery("SELECT hof.playerID, nameFirst, nameLast,
              min(hof.yearid) AS first_year, ballots, needed,
              votes, max(votes/ballots) as PCT, 
              sum(inducted = 'Y') as indct, sum(G) as G,
              sum(pi.GS) as GS, sum(IPouts/3) as IP,
              sum(CG) as CG, sum(SHO) as SHO, sum(SV) as SV,
              sum(W) as W, sum(L) as L, sum(H) as H, 
              sum(BB) as BB, sum(ER) as ER, sum(SO) as SO,
              ((sum(ER) / (sum(IPouts)/3)) * 9) as ERA,
              ((sum(H) + sum(BB)) / (sum(IPouts) / 3)) as WHIP 
    FROM lahman.HallOfFame AS hof
    JOIN lahman.Master AS ma on ma.playerID = hof.playerID
    JOIN lahman.Pitching AS pi on pi.playerID = hof.playerID
    WHERE hof.yearid > 1979
    GROUP BY hof.playerID
    HAVING indct = 0
      AND G > 100
      AND PCT > 0.2
    ORDER BY PCT desc;")

pitchers_not_inducted
```

```{r}
all_hitters <- hitters %>% 
  full_join(batters_not_inducted)

all_pitchers <- pitchers %>% 
  full_join(pitchers_not_inducted)
```

```{r}
ggplot(all_hitters, aes(x = HR, y = AVG)) +
  geom_point()
```

